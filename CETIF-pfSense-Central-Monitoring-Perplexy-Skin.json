{
  "annotations": {
    "list": [
      {
        "builtIn": 1,
        "datasource": {
          "type": "grafana",
          "uid": "-- Grafana --"
        },
        "enable": true,
        "hide": true,
        "iconColor": "rgba(0, 211, 255, 1)",
        "name": "Annotations & Alerts",
        "type": "dashboard"
      }
    ]
  },
  "editable": true,
  "fiscalYearStartMonth": 0,
  "graphTooltip": 0,
  "id": 103,
  "links": [],
  "panels": [
    {
      "datasource": {
        "type": "alexanderzobnin-zabbix-datasource",
        "uid": "aec2bvjiis7pca"
      },
      "fieldConfig": {
        "defaults": {
          "mappings": [],
          "thresholds": {
            "mode": "absolute",
            "steps": [
              {
                "color": "green",
                "value": null
              }
            ]
          }
        },
        "overrides": []
      },
      "gridPos": {
        "h": 39,
        "w": 23,
        "x": 0,
        "y": 0
      },
      "id": 1,
      "options": {
        "SVGBaseFix": true,
        "add100Percentage": true,
        "calcsMutation": "standard",
        "centerAlignContent": false,
        "codeData": "{}",
        "css": "*{margin:0;padding:0;box-sizing:border-box}body{background:#0a0a0a;color:#fff;font-family:'Inter',system-ui,-apple-system,sans-serif}.dashboard{background:#0a0a0a;min-height:100vh;padding:20px}.header{display:flex;justify-content:space-between;align-items:center;margin-bottom:30px;padding-bottom:20px;border-bottom:1px solid #222}.logo{font-size:32px;font-weight:700;letter-spacing:3px;background:linear-gradient(135deg,#667eea,#764ba2);-webkit-background-clip:text;-webkit-text-fill-color:transparent;background-clip:text}.header-center{text-align:center}.header-title{font-size:24px;font-weight:700;letter-spacing:3px;margin-bottom:5px}.header-subtitle{font-size:12px;color:#888;letter-spacing:1px}.clock{font-size:22px;font-weight:300;letter-spacing:2px;font-variant-numeric:tabular-nums}.main-grid{display:grid;grid-template-columns:380px 1fr;gap:20px;margin-bottom:20px}.card{background:#111;border:1px solid #222;border-radius:16px;padding:20px}.card-title{font-size:13px;font-weight:700;letter-spacing:2px;margin-bottom:15px;text-transform:uppercase;color:#888;text-align:center}.summary-item{display:flex;justify-content:space-between;align-items:center;padding:12px 15px;background:#1a1a1a;border-radius:10px;border-left:3px solid #667eea;margin-bottom:10px}.summary-label{font-size:12px;color:#888;font-weight:600;letter-spacing:1px}.summary-value{font-size:16px;font-weight:700;color:#fff}.wan-grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(280px,1fr));gap:15px;margin-bottom:20px}.interface-card{background:#1a1a1a;border:1px solid #222;border-radius:12px;padding:15px;position:relative;overflow:hidden}.interface-card::before{content:'';position:absolute;top:0;left:0;right:0;height:3px;background:linear-gradient(90deg,#00e676,#00c853)}.interface-card.warn::before{background:linear-gradient(90deg,#ffc107,#ff9800)}.interface-card.down::before{background:linear-gradient(90deg,#ff1744,#d50000)}.interface-header{display:flex;justify-content:space-between;align-items:center;margin-bottom:15px}.interface-name{font-size:13px;font-weight:700;letter-spacing:1px;color:#fff}.status-badge{padding:4px 12px;border-radius:20px;font-size:10px;font-weight:700;letter-spacing:1px;text-transform:uppercase}.status-badge.up{background:rgba(0,230,118,.2);color:#00e676;border:1px solid #00e676}.status-badge.warn{background:rgba(255,193,7,.2);color:#ffc107;border:1px solid #ffc107}.status-badge.down{background:rgba(255,23,68,.2);color:#ff1744;border:1px solid #ff1744}.traffic-row{display:flex;justify-content:space-between;align-items:center;margin-bottom:8px;font-size:11px}.traffic-label{color:#888;font-weight:600;letter-spacing:.5px}.traffic-value{font-weight:700;color:#fff;font-variant-numeric:tabular-nums}.progress-bar{height:8px;background:#0d1117;border-radius:10px;overflow:hidden;margin-bottom:10px;border:1px solid #222}.progress-fill{height:100%;transition:width .3s ease;border-radius:10px}.progress-fill.in{background:linear-gradient(90deg,#667eea,#764ba2)}.progress-fill.out{background:linear-gradient(90deg,#00e676,#00c853)}.error-row{display:flex;justify-content:space-between;font-size:10px;color:#666;margin-top:10px}.error-row.has-error{color:#ff1744}.gateway-card{background:#1a1a1a;border:1px solid #222;border-radius:12px;padding:15px}.gateway-card::before{content:'';position:absolute;top:0;left:0;right:0;height:3px}.gateway-header{display:flex;justify-content:space-between;align-items:center;margin-bottom:12px}.metric-row{display:flex;justify-content:space-between;padding:8px 0;border-bottom:1px solid #222;font-size:11px}.metric-row:last-child{border-bottom:none}.metric-label{color:#888;font-weight:600}.metric-value{color:#fff;font-weight:700;font-variant-numeric:tabular-nums}.ovpn-card{background:#1a1a1a;border:1px solid #222;border-radius:12px;padding:15px;border-top:3px solid #2196f3}.ovpn-header{display:flex;justify-content:space-between;align-items:center;margin-bottom:10px}.ovpn-name{font-size:12px;font-weight:700;color:#fff;letter-spacing:.5px}.client-count{font-size:24px;font-weight:700;color:#2196f3;text-align:center;margin-top:10px}.lan-grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(300px,1fr));gap:15px}@media (max-width:1200px){.main-grid{grid-template-columns:1fr}.wan-grid{grid-template-columns:repeat(auto-fit,minmax(250px,1fr))}}",
        "dynamicData": false,
        "dynamicFieldDisplayValues": false,
        "dynamicHtmlGraphics": false,
        "dynamicProps": false,
        "fitContentToPanel": true,
        "html": "<div class=\"dashboard\"><div class=\"header\"><div class=\"logo\">CETIF</div><div class=\"header-center\"><div class=\"header-title\">PFSENSE CENTRAL MONITORING</div><div class=\"header-subtitle\">Network Health + Gateways + VPN + Traffic Analysis + System Monitoring</div></div><div class=\"clock\" id=\"clock\">00:00:00</div></div><div class=\"main-grid\"><div class=\"card\"><div class=\"card-title\">System Overview</div><div id=\"summary\"></div><div class=\"card-title\" style=\"margin-top:20px\">Active Alerts</div><div id=\"alerts\"></div><div class=\"card-title\" style=\"margin-top:20px\">Gateway Status</div><div id=\"gateway-summary\"></div><div class=\"card-title\" style=\"margin-top:20px\">VPN Overview</div><div id=\"vpn-summary\"></div></div><div><div class=\"card\"><div class=\"card-title\">WAN Links</div><div class=\"wan-grid\" id=\"wan-interfaces\"></div></div><div class=\"card\" style=\"margin-top:20px\"><div class=\"card-title\">Gateway Metrics (All)</div><div class=\"wan-grid\" id=\"gateways\"></div></div><div class=\"card\" style=\"margin-top:20px\"><div class=\"card-title\">OpenVPN Servers</div><div class=\"wan-grid\" id=\"ovpn-servers\"></div></div></div></div><div class=\"card\"><div class=\"card-title\">LAN / VLAN / DMZ Interfaces (Top 12 by Traffic)</div><div class=\"lan-grid\" id=\"lan-interfaces\"></div></div></div>",
        "onInit": "",
        "onInitOnResize": false,
        "onRender": "(() => {\n  if (!htmlNode || !data || !data.series) return;\n\n  const el = (q) => htmlNode.querySelector(q);\n  const setText = (q, v) => { const n = el(q); if(n) n.innerHTML = v; };\n\n  const last = (series) => {\n    const n = series.fields.find(f => f.type === 'number');\n    if (n && n.values.length) return n.values.get(n.values.length - 1);\n    const s = series.fields.find(f => f.type === 'string');\n    if (s && s.values.length) return s.values.get(s.values.length - 1);\n    return null;\n  };\n\n  const findLastByName = (name) => {\n    const s = data.series.find(x => x.name === name);\n    return s ? last(s) : null;\n  };\n\n  const toNum = (v) => (isFinite(Number(v)) ? Number(v) : 0);\n\n  const bps = (v) => {\n    const x = Number(v ?? 0);\n    if (!isFinite(x) || x < 0) return '0 b/s';\n    const units = ['b/s','Kb/s','Mb/s','Gb/s','Tb/s'];\n    let i=0, val=x;\n    while (val >= 1024 && i < units.length-1){ val/=1024; i++; }\n    return `${val.toFixed(val >= 100 ? 0 : val >= 10 ? 1 : 2)} ${units[i]}`;\n  };\n\n  const formatUptime = (bootTime) => {\n    if (!bootTime) return '--';\n    const now = Math.floor(Date.now() / 1000);\n    const upSec = now - bootTime;\n    const days = Math.floor(upSec / 86400);\n    const hours = Math.floor((upSec % 86400) / 3600);\n    const mins = Math.floor((upSec % 3600) / 60);\n    if (days > 0) return `${days}d ${hours}h`;\n    if (hours > 0) return `${hours}h ${mins}m`;\n    return `${mins}m`;\n  };\n\n  const formatCertDays = (unixTime) => {\n    if (!unixTime) return null;\n    const now = Math.floor(Date.now() / 1000);\n    const diff = unixTime - now;\n    const days = Math.floor(diff / 86400);\n    return days;\n  };\n\n  // Update clock\n  const updateClock = () => {\n    const now = new Date();\n    const h = String(now.getHours()).padStart(2, '0');\n    const m = String(now.getMinutes()).padStart(2, '0');\n    const s = String(now.getSeconds()).padStart(2, '0');\n    setText('#clock', `${h}:${m}:${s}`);\n  };\n  updateClock();\n  setInterval(updateClock, 1000);\n\n  // Parse interfaces\n  const rxRe = /^Incoming network traffic on (.+)$/i;\n  const txRe = /^Outgoing network traffic on (.+)$/i;\n  const rxErrRe = /^Incoming errors on (.+)$/i;\n  const txErrRe = /^Outgoing errors on (.+)$/i;\n\n  const byIf = new Map();\n  const ensure = (ifn) => {\n    if (!byIf.has(ifn)) byIf.set(ifn, { rx:0, tx:0, rxErr:0, txErr:0 });\n    return byIf.get(ifn);\n  };\n\n  for (const s of data.series) {\n    const name = s.name || '';\n    let m;\n    if ((m = name.match(rxRe))) ensure(m[1].trim()).rx = toNum(last(s));\n    else if ((m = name.match(txRe))) ensure(m[1].trim()).tx = toNum(last(s));\n    else if ((m = name.match(rxErrRe))) ensure(m[1].trim()).rxErr = toNum(last(s));\n    else if ((m = name.match(txErrRe))) ensure(m[1].trim()).txErr = toNum(last(s));\n  }\n\n  const isWan = (n) => /^WAN($|[_-])/i.test(n);\n\n  const items = [...byIf.entries()].map(([ifName, v]) => ({ ifName, ...v }));\n  const wan = items.filter(x => isWan(x.ifName));\n  const lan = items\n    .filter(x => !isWan(x.ifName))\n    .filter(x => !x.ifName.toLowerCase().startsWith('ovpns'))\n    .sort((a,b) => (b.rx+b.tx) - (a.rx+a.tx))\n    .slice(0, 12);\n\n  const errTotal = items.reduce((acc, x) => acc + x.rxErr + x.txErr, 0);\n\n  // System metrics\n  const cpuIdle = toNum(findLastByName('CPU idle time'));\n  const cpuUser = toNum(findLastByName('CPU user time'));\n  const cpuSystem = toNum(findLastByName('CPU System time'));\n  const cpuUsage = 100 - cpuIdle;\n  const memAvail = toNum(findLastByName('Available memory (percent)'));\n  const memUsage = 100 - memAvail;\n  const diskFree = toNum(findLastByName('Free disk space on / (percentage)'));\n  const diskUsage = 100 - diskFree;\n  const swapFree = toNum(findLastByName('Free swap space in %'));\n  const swapUsage = 100 - swapFree;\n  const procTotal = toNum(findLastByName('Number of processes'));\n  const procRun = toNum(findLastByName('Number of running processes'));\n  const bootTime = toNum(findLastByName('Host boot time'));\n  const uptime = formatUptime(bootTime);\n  const mbufUsage = toNum(findLastByName('MBUF Total Used (percent)'));\n  const newVersion = findLastByName('New Version of pfSense Available');\n  const certExpiry = toNum(findLastByName('Certificates Manager: earliest validTo'));\n  const certDays = formatCertDays(certExpiry);\n  const dhcpProblems = toNum(findLastByName('DHCP Failover Pool Problems'));\n  const carpStatus = findLastByName('CARP Status');\n  const carpExpected = findLastByName('Expected CARP Status');\n  const ipsecStatus = findLastByName('IPsec Tunnel 1 VPN CIELO  Phase 1 Status');\n  const ipsecEnabled = findLastByName('IPsec Tunnel 1 VPN CIELO Tunnel Enabled');\n\n  // System Overview + System Health\n  const summaryHTML = `\n    <div class=\"summary-item\">\n      <span class=\"summary-label\">WANs Monitored</span>\n      <span class=\"summary-value\">${wan.length}</span>\n    </div>\n    <div class=\"summary-item\">\n      <span class=\"summary-label\">Total Interfaces</span>\n      <span class=\"summary-value\">${items.length}</span>\n    </div>\n    <div class=\"summary-item\">\n      <span class=\"summary-label\">Total Errors</span>\n      <span class=\"summary-value\" style=\"color:${errTotal > 0 ? '#ff1744' : '#00e676'}\">${errTotal}</span>\n    </div>\n    <div class=\"summary-item\" style=\"margin-top:20px\">\n      <span class=\"summary-label\">CPU Usage</span>\n      <span class=\"summary-value\" style=\"color:${cpuUsage > 80 ? '#ff1744' : cpuUsage > 60 ? '#ffc107' : '#00e676'}\">${cpuUsage.toFixed(1)}%</span>\n    </div>\n    <div class=\"summary-item\">\n      <span class=\"summary-label\">Memory Usage</span>\n      <span class=\"summary-value\" style=\"color:${memUsage > 90 ? '#ff1744' : memUsage > 75 ? '#ffc107' : '#00e676'}\">${memUsage.toFixed(1)}%</span>\n    </div>\n    <div class=\"summary-item\">\n      <span class=\"summary-label\">Disk Usage</span>\n      <span class=\"summary-value\" style=\"color:${diskUsage > 85 ? '#ff1744' : diskUsage > 70 ? '#ffc107' : '#00e676'}\">${diskUsage.toFixed(1)}%</span>\n    </div>\n    <div class=\"summary-item\">\n      <span class=\"summary-label\">Uptime</span>\n      <span class=\"summary-value\">${uptime}</span>\n    </div>\n    <div class=\"summary-item\">\n      <span class=\"summary-label\">Processes</span>\n      <span class=\"summary-value\">${procRun} / ${procTotal}</span>\n    </div>\n  `;\n  setText('#summary', summaryHTML);\n\n  // Render interface card\n  const mkIfCard = (x) => {\n    const total = x.rx + x.tx;\n    const hasTraffic = total > 0;\n    const hasErr = (x.rxErr + x.txErr) > 0;\n\n    let status = 'up', label = 'ONLINE';\n    if (hasErr) { status = 'warn'; label = 'WARNING'; }\n    else if (!hasTraffic) { status = 'down'; label = 'OFFLINE'; }\n\n    const rxPct = total > 0 ? Math.min((x.rx / total) * 100, 100) : 0;\n    const txPct = total > 0 ? Math.min((x.tx / total) * 100, 100) : 0;\n\n    return `\n      <div class=\"interface-card ${status}\">\n        <div class=\"interface-header\">\n          <div class=\"interface-name\">${x.ifName}</div>\n          <div class=\"status-badge ${status}\">${label}</div>\n        </div>\n        <div class=\"traffic-row\">\n          <span class=\"traffic-label\">⬇ INBOUND</span>\n          <span class=\"traffic-value\">${bps(x.rx)}</span>\n        </div>\n        <div class=\"progress-bar\">\n          <div class=\"progress-fill in\" style=\"width:${rxPct.toFixed(1)}%\"></div>\n        </div>\n        <div class=\"traffic-row\">\n          <span class=\"traffic-label\">⬆ OUTBOUND</span>\n          <span class=\"traffic-value\">${bps(x.tx)}</span>\n        </div>\n        <div class=\"progress-bar\">\n          <div class=\"progress-fill out\" style=\"width:${txPct.toFixed(1)}%\"></div>\n        </div>\n        <div class=\"error-row ${hasErr ? 'has-error' : ''}\">\n          <span>Errors IN/OUT:</span>\n          <span>${x.rxErr} / ${x.txErr}</span>\n        </div>\n      </div>\n    `;\n  };\n\n  setText('#wan-interfaces', wan.map(mkIfCard).join(''));\n  setText('#lan-interfaces', lan.map(mkIfCard).join(''));\n\n  // Gateways - TODOS\n  const gwRaw = findLastByName('Gateway Status Raw');\n  const gwNames = ['WAN', 'GW_WAN_CTI', 'defualtvl', 'extranet_ctiGW2', 'extranet_sfzGW', 'GW_DMZ', 'intranet', 'srvsintranet'];\n\n  const gw = gwNames.map(name => ({\n    name,\n    status: findLastByName(`Gateway ${name} Status`),\n    loss: findLastByName(`Gateway ${name} Packet  Loss`),\n    rtt: findLastByName(`Gateway ${name} RTT`),\n    stddev: findLastByName(`Gateway ${name} RTT Std Deviation`)\n  })).filter(g => g.status != null);\n\n  const gwOnline = gw.filter(g => /up|online/i.test(String(g.status))).length;\n  const gwTotal = gw.length;\n\n  const gwSummaryHTML = `\n    <div class=\"summary-item\">\n      <span class=\"summary-label\">Gateways Online</span>\n      <span class=\"summary-value\" style=\"color:${gwOnline < gwTotal ? '#ffc107' : '#00e676'}\">${gwOnline} / ${gwTotal}</span>\n    </div>\n    <div class=\"summary-item\">\n      <span class=\"summary-label\">Raw Status</span>\n      <span class=\"summary-value\" style=\"font-size:10px\">${gwRaw ?? '--'}</span>\n    </div>\n  `;\n  setText('#gateway-summary', gwSummaryHTML);\n\n  const mkGwCard = (g) => {\n    const s = (g.status ?? '').toString();\n    const isUp = /up|online/i.test(s);\n    const lossNum = toNum((g.loss ?? '').toString().replace('%',''));\n    const rttNum = toNum((g.rtt ?? '').toString().replace('ms',''));\n    const stddevNum = toNum((g.stddev ?? '').toString().replace('ms',''));\n\n    let badge = 'up', label = 'ONLINE';\n    if (!isUp) { badge='down'; label='OFFLINE'; }\n    else if (lossNum >= 2 || stddevNum > 10) { badge='warn'; label='DEGRADED'; }\n\n    const lossTxt = g.loss == null ? '--' : (typeof g.loss === 'number' ? `${g.loss.toFixed(1)}%` : String(g.loss));\n    const rttTxt = g.rtt == null ? '--' : (typeof g.rtt === 'number' ? `${g.rtt.toFixed(1)} ms` : String(g.rtt));\n    const stddevTxt = g.stddev == null ? '--' : (typeof g.stddev === 'number' ? `${g.stddev.toFixed(1)} ms` : String(g.stddev));\n\n    return `\n      <div class=\"gateway-card ${badge}\">\n        <div class=\"gateway-header\">\n          <div class=\"interface-name\">GW ${g.name}</div>\n          <div class=\"status-badge ${badge}\">${label}</div>\n        </div>\n        <div class=\"metric-row\">\n          <span class=\"metric-label\">Packet Loss</span>\n          <span class=\"metric-value\" style=\"color:${lossNum > 2 ? '#ff1744' : '#00e676'}\">${lossTxt}</span>\n        </div>\n        <div class=\"metric-row\">\n          <span class=\"metric-label\">RTT</span>\n          <span class=\"metric-value\">${rttTxt}</span>\n        </div>\n        <div class=\"metric-row\">\n          <span class=\"metric-label\">Jitter (stddev)</span>\n          <span class=\"metric-value\" style=\"color:${stddevNum > 10 ? '#ffc107' : '#888'}\">${stddevTxt}</span>\n        </div>\n      </div>\n    `;\n  };\n\n  setText('#gateways', gw.map(mkGwCard).join(''));\n\n  // OpenVPN - com Tunnel Status\n  const ovpnRe = /^OpenVPN Server (.+) Clients Connected$/i;\n  const ovpnStatusRe = /^OpenVPN Server (.+) Tunnel Status$/i;\n  const ovpnServers = [];\n\n  for (const s of data.series) {\n    const name = s.name || '';\n    const m = name.match(ovpnRe);\n    if (!m) continue;\n    const serverName = m[1].trim();\n    const clients = toNum(last(s));\n\n    const statusSeries = data.series.find(x => x.name === `OpenVPN Server ${serverName} Tunnel Status`);\n    const tunnelStatus = statusSeries ? last(statusSeries) : null;\n\n    ovpnServers.push({ serverName, clients, tunnelStatus });\n  }\n\n  ovpnServers.sort((a,b) => b.clients - a.clients);\n  const totalClients = ovpnServers.reduce((acc,x)=>acc+x.clients,0);\n  const tunnelsUp = ovpnServers.filter(x => {\n    const st = String(x.tunnelStatus ?? '').toLowerCase();\n    return st.includes('up') || st.includes('connected') || st.includes('ok');\n  }).length;\n\n  const vpnSummaryHTML = `\n    <div class=\"summary-item\">\n      <span class=\"summary-label\">Total VPN Clients</span>\n      <span class=\"summary-value\" style=\"color:#2196f3\">${totalClients}</span>\n    </div>\n    <div class=\"summary-item\">\n      <span class=\"summary-label\">Tunnels UP</span>\n      <span class=\"summary-value\">${tunnelsUp} / ${ovpnServers.length}</span>\n    </div>\n  `;\n  setText('#vpn-summary', vpnSummaryHTML);\n\n  const mkOvpnCard = (o) => {\n    const st = String(o.tunnelStatus ?? '').toLowerCase();\n    const isTunnelUp = st.includes('up') || st.includes('connected') || st.includes('ok');\n\n    let badge='down', label='DOWN';\n    if (isTunnelUp) {\n      if (o.clients > 0) { badge='up'; label='ACTIVE'; }\n      else { badge='warn'; label='IDLE'; }\n    }\n\n    return `\n      <div class=\"ovpn-card\">\n        <div class=\"ovpn-header\">\n          <div class=\"ovpn-name\">${o.serverName}</div>\n          <div class=\"status-badge ${badge}\">${label}</div>\n        </div>\n        <div class=\"client-count\">${o.clients}</div>\n        <div style=\"text-align:center;font-size:10px;color:#888;margin-top:5px\">CONNECTED CLIENTS</div>\n        <div style=\"text-align:center;font-size:9px;color:#666;margin-top:3px\">Tunnel: ${o.tunnelStatus ?? 'unknown'}</div>\n      </div>\n    `;\n  };\n\n  const topOvpn = ovpnServers;\n  setText('#ovpn-servers', topOvpn.length ? topOvpn.map(mkOvpnCard).join('') : '<div style=\"text-align:center;color:#888;padding:20px\">No VPN servers</div>');\n\n  // Alerts Section\n  const alerts = [];\n\n  if (newVersion && String(newVersion).toLowerCase() !== 'no') {\n    alerts.push({ severity: 'warn', msg: `pfSense update available: ${newVersion}` });\n  }\n\n  if (certDays !== null && certDays < 30) {\n    alerts.push({ severity: certDays < 7 ? 'critical' : 'warn', msg: `Certificate expires in ${certDays} days` });\n  }\n\n  if (mbufUsage > 80) {\n    alerts.push({ severity: 'critical', msg: `MBUF usage critical: ${mbufUsage.toFixed(1)}%` });\n  }\n\n  if (dhcpProblems > 0) {\n    alerts.push({ severity: 'warn', msg: `DHCP Failover issues: ${dhcpProblems}` });\n  }\n\n  if (carpStatus && carpExpected && carpStatus !== carpExpected) {\n    alerts.push({ severity: 'critical', msg: `CARP status mismatch: ${carpStatus} (expected ${carpExpected})` });\n  }\n\n  if (ipsecStatus && ipsecEnabled !== '1') {\n    const st = String(ipsecStatus).toLowerCase();\n    if (!st.includes('up') && !st.includes('connected')) {\n      alerts.push({ severity: 'warn', msg: `IPsec VPN CIELO: ${ipsecStatus}` });\n    }\n  }\n\n  if (errTotal > 100) {\n    alerts.push({ severity: 'warn', msg: `High interface errors: ${errTotal} total` });\n  }\n\n  const alertsHTML = alerts.length === 0 \n    ? '<div class=\"summary-item\" style=\"background:#1a3a1a\"><span class=\"summary-label\">System Status</span><span class=\"summary-value\" style=\"color:#00e676\">ALL OK</span></div>'\n    : alerts.map(a => {\n        const color = a.severity === 'critical' ? '#ff1744' : '#ffc107';\n        return `<div class=\"summary-item\" style=\"border-left:3px solid ${color}\"><span class=\"summary-label\" style=\"color:${color}\">${a.severity.toUpperCase()}</span><span class=\"summary-value\" style=\"font-size:10px;color:#fff\">${a.msg}</span></div>`;\n      }).join('');\n\n  setText('#alerts', alertsHTML);\n})();",
        "overflow": "visible",
        "panelupdateOnMount": true,
        "reduceOptions": {
          "calcs": [
            "lastNotNull"
          ]
        },
        "renderOnMount": true,
        "rootCSS": "",
        "svgBaseFix": false,
        "useGrafanaScrollbar": false
      },
      "pluginVersion": "2.2.3",
      "targets": [
        {
          "datasource": {
            "type": "alexanderzobnin-zabbix-datasource",
            "uid": "aec2bvjiis7pca"
          },
          "group": {
            "filter": "SRVINTRANET"
          },
          "host": {
            "filter": "PFSENSE"
          },
          "item": {
            "filter": "Incoming network traffic on WAN"
          },
          "queryType": "0",
          "refId": "A",
          "resultFormat": "time_series"
        },
        {
          "datasource": {
            "type": "alexanderzobnin-zabbix-datasource",
            "uid": "aec2bvjiis7pca"
          },
          "group": {
            "filter": "SRVINTRANET"
          },
          "host": {
            "filter": "PFSENSE"
          },
          "item": {
            "filter": "Outgoing network traffic on WAN"
          },
          "queryType": "0",
          "refId": "B",
          "resultFormat": "time_series"
        },
        {
          "datasource": {
            "type": "alexanderzobnin-zabbix-datasource",
            "uid": "aec2bvjiis7pca"
          },
          "group": {
            "filter": "SRVINTRANET"
          },
          "host": {
            "filter": "PFSENSE"
          },
          "item": {
            "filter": "Incoming errors on WAN"
          },
          "queryType": "0",
          "refId": "C",
          "resultFormat": "time_series"
        },
        {
          "datasource": {
            "type": "alexanderzobnin-zabbix-datasource",
            "uid": "aec2bvjiis7pca"
          },
          "group": {
            "filter": "SRVINTRANET"
          },
          "host": {
            "filter": "PFSENSE"
          },
          "item": {
            "filter": "Outgoing errors on WAN"
          },
          "queryType": "0",
          "refId": "D",
          "resultFormat": "time_series"
        },
        {
          "datasource": {
            "type": "alexanderzobnin-zabbix-datasource",
            "uid": "aec2bvjiis7pca"
          },
          "group": {
            "filter": "SRVINTRANET"
          },
          "host": {
            "filter": "PFSENSE"
          },
          "item": {
            "filter": "Incoming network traffic on WAN_CTI"
          },
          "queryType": "0",
          "refId": "E",
          "resultFormat": "time_series"
        },
        {
          "datasource": {
            "type": "alexanderzobnin-zabbix-datasource",
            "uid": "aec2bvjiis7pca"
          },
          "group": {
            "filter": "SRVINTRANET"
          },
          "host": {
            "filter": "PFSENSE"
          },
          "item": {
            "filter": "Outgoing network traffic on WAN_CTI"
          },
          "queryType": "0",
          "refId": "F",
          "resultFormat": "time_series"
        },
        {
          "datasource": {
            "type": "alexanderzobnin-zabbix-datasource",
            "uid": "aec2bvjiis7pca"
          },
          "group": {
            "filter": "SRVINTRANET"
          },
          "host": {
            "filter": "PFSENSE"
          },
          "item": {
            "filter": "Incoming errors on WAN_CTI"
          },
          "queryType": "0",
          "refId": "G",
          "resultFormat": "time_series"
        },
        {
          "datasource": {
            "type": "alexanderzobnin-zabbix-datasource",
            "uid": "aec2bvjiis7pca"
          },
          "group": {
            "filter": "SRVINTRANET"
          },
          "host": {
            "filter": "PFSENSE"
          },
          "item": {
            "filter": "Outgoing errors on WAN_CTI"
          },
          "queryType": "0",
          "refId": "H",
          "resultFormat": "time_series"
        },
        {
          "datasource": {
            "type": "alexanderzobnin-zabbix-datasource",
            "uid": "aec2bvjiis7pca"
          },
          "group": {
            "filter": "SRVINTRANET"
          },
          "host": {
            "filter": "PFSENSE"
          },
          "item": {
            "filter": "Incoming network traffic on INTRANET"
          },
          "queryType": "0",
          "refId": "I",
          "resultFormat": "time_series"
        },
        {
          "datasource": {
            "type": "alexanderzobnin-zabbix-datasource",
            "uid": "aec2bvjiis7pca"
          },
          "group": {
            "filter": "SRVINTRANET"
          },
          "host": {
            "filter": "PFSENSE"
          },
          "item": {
            "filter": "Outgoing network traffic on INTRANET"
          },
          "queryType": "0",
          "refId": "J",
          "resultFormat": "time_series"
        },
        {
          "datasource": {
            "type": "alexanderzobnin-zabbix-datasource",
            "uid": "aec2bvjiis7pca"
          },
          "group": {
            "filter": "SRVINTRANET"
          },
          "host": {
            "filter": "PFSENSE"
          },
          "item": {
            "filter": "Incoming network traffic on EXTRANET_SFZ"
          },
          "queryType": "0",
          "refId": "K",
          "resultFormat": "time_series"
        },
        {
          "datasource": {
            "type": "alexanderzobnin-zabbix-datasource",
            "uid": "aec2bvjiis7pca"
          },
          "group": {
            "filter": "SRVINTRANET"
          },
          "host": {
            "filter": "PFSENSE"
          },
          "item": {
            "filter": "Outgoing network traffic on EXTRANET_SFZ"
          },
          "queryType": "0",
          "refId": "L",
          "resultFormat": "time_series"
        },
        {
          "datasource": {
            "type": "alexanderzobnin-zabbix-datasource",
            "uid": "aec2bvjiis7pca"
          },
          "group": {
            "filter": "SRVINTRANET"
          },
          "host": {
            "filter": "PFSENSE"
          },
          "item": {
            "filter": "Incoming network traffic on DMZ"
          },
          "queryType": "0",
          "refId": "M",
          "resultFormat": "time_series"
        },
        {
          "datasource": {
            "type": "alexanderzobnin-zabbix-datasource",
            "uid": "aec2bvjiis7pca"
          },
          "group": {
            "filter": "SRVINTRANET"
          },
          "host": {
            "filter": "PFSENSE"
          },
          "item": {
            "filter": "Outgoing network traffic on DMZ"
          },
          "queryType": "0",
          "refId": "N",
          "resultFormat": "time_series"
        },
        {
          "datasource": {
            "type": "alexanderzobnin-zabbix-datasource",
            "uid": "aec2bvjiis7pca"
          },
          "group": {
            "filter": "SRVINTRANET"
          },
          "host": {
            "filter": "PFSENSE"
          },
          "item": {
            "filter": "Incoming network traffic on SRVSINTRANET"
          },
          "queryType": "0",
          "refId": "O",
          "resultFormat": "time_series"
        },
        {
          "datasource": {
            "type": "alexanderzobnin-zabbix-datasource",
            "uid": "aec2bvjiis7pca"
          },
          "group": {
            "filter": "SRVINTRANET"
          },
          "host": {
            "filter": "PFSENSE"
          },
          "item": {
            "filter": "Outgoing network traffic on SRVSINTRANET"
          },
          "queryType": "0",
          "refId": "P",
          "resultFormat": "time_series"
        },
        {
          "datasource": {
            "type": "alexanderzobnin-zabbix-datasource",
            "uid": "aec2bvjiis7pca"
          },
          "group": {
            "filter": "SRVINTRANET"
          },
          "host": {
            "filter": "PFSENSE"
          },
          "item": {
            "filter": "Gateway Status Raw"
          },
          "queryType": "0",
          "refId": "Q",
          "resultFormat": "time_series"
        },
        {
          "datasource": {
            "type": "alexanderzobnin-zabbix-datasource",
            "uid": "aec2bvjiis7pca"
          },
          "group": {
            "filter": "SRVINTRANET"
          },
          "host": {
            "filter": "PFSENSE"
          },
          "item": {
            "filter": "Gateway WAN Status"
          },
          "queryType": "0",
          "refId": "R",
          "resultFormat": "time_series"
        },
        {
          "datasource": {
            "type": "alexanderzobnin-zabbix-datasource",
            "uid": "aec2bvjiis7pca"
          },
          "group": {
            "filter": "SRVINTRANET"
          },
          "host": {
            "filter": "PFSENSE"
          },
          "item": {
            "filter": "Gateway WAN Packet Loss"
          },
          "queryType": "0",
          "refId": "S",
          "resultFormat": "time_series"
        },
        {
          "datasource": {
            "type": "alexanderzobnin-zabbix-datasource",
            "uid": "aec2bvjiis7pca"
          },
          "group": {
            "filter": "SRVINTRANET"
          },
          "host": {
            "filter": "PFSENSE"
          },
          "item": {
            "filter": "Gateway WAN RTT"
          },
          "queryType": "0",
          "refId": "T",
          "resultFormat": "time_series"
        },
        {
          "datasource": {
            "type": "alexanderzobnin-zabbix-datasource",
            "uid": "aec2bvjiis7pca"
          },
          "group": {
            "filter": "SRVINTRANET"
          },
          "host": {
            "filter": "PFSENSE"
          },
          "item": {
            "filter": "Gateway GW_WAN_CTI Status"
          },
          "queryType": "0",
          "refId": "U",
          "resultFormat": "time_series"
        },
        {
          "datasource": {
            "type": "alexanderzobnin-zabbix-datasource",
            "uid": "aec2bvjiis7pca"
          },
          "group": {
            "filter": "SRVINTRANET"
          },
          "host": {
            "filter": "PFSENSE"
          },
          "item": {
            "filter": "Gateway GW_WAN_CTI Packet Loss"
          },
          "queryType": "0",
          "refId": "V",
          "resultFormat": "time_series"
        },
        {
          "datasource": {
            "type": "alexanderzobnin-zabbix-datasource",
            "uid": "aec2bvjiis7pca"
          },
          "group": {
            "filter": "SRVINTRANET"
          },
          "host": {
            "filter": "PFSENSE"
          },
          "item": {
            "filter": "Gateway GW_WAN_CTI RTT"
          },
          "queryType": "0",
          "refId": "W",
          "resultFormat": "time_series"
        },
        {
          "datasource": {
            "type": "alexanderzobnin-zabbix-datasource",
            "uid": "aec2bvjiis7pca"
          },
          "group": {
            "filter": "SRVINTRANET"
          },
          "host": {
            "filter": "PFSENSE"
          },
          "item": {
            "filter": "OpenVPN Server VPN_LUCIO_MT Clients Connected"
          },
          "queryType": "0",
          "refId": "X",
          "resultFormat": "time_series"
        },
        {
          "datasource": {
            "type": "alexanderzobnin-zabbix-datasource",
            "uid": "aec2bvjiis7pca"
          },
          "group": {
            "filter": "SRVINTRANET"
          },
          "host": {
            "filter": "PFSENSE"
          },
          "item": {
            "filter": "OpenVPN Server VPN_CARCD Clients Connected"
          },
          "queryType": "0",
          "refId": "Y",
          "resultFormat": "time_series"
        },
        {
          "datasource": {
            "type": "alexanderzobnin-zabbix-datasource",
            "uid": "aec2bvjiis7pca"
          },
          "group": {
            "filter": "SRVINTRANET"
          },
          "host": {
            "filter": "PFSENSE"
          },
          "item": {
            "filter": "OpenVPN Server VPN MATRIZ-JUNDIA Clients Connected"
          },
          "queryType": "0",
          "refId": "Z",
          "resultFormat": "time_series"
        },
        {
          "datasource": {
            "type": "alexanderzobnin-zabbix-datasource",
            "uid": "aec2bvjiis7pca"
          },
          "group": {
            "filter": "SRVINTRANET"
          },
          "host": {
            "filter": "PFSENSE"
          },
          "item": {
            "filter": "OpenVPN Server SEPLAN Clients Connected"
          },
          "queryType": "0",
          "refId": "AA",
          "resultFormat": "time_series"
        },
        {
          "datasource": {
            "type": "alexanderzobnin-zabbix-datasource",
            "uid": "aec2bvjiis7pca"
          },
          "group": {
            "filter": "SRVINTRANET"
          },
          "host": {
            "filter": "PFSENSE"
          },
          "item": {
            "filter": "OpenVPN Server SEFAZ Clients Connected"
          },
          "queryType": "0",
          "refId": "AB",
          "resultFormat": "time_series"
        },
        {
          "datasource": {
            "type": "alexanderzobnin-zabbix-datasource",
            "uid": "aec2bvjiis7pca"
          },
          "group": {
            "filter": "SRVINTRANET"
          },
          "host": {
            "filter": "PFSENSE"
          },
          "item": {
            "filter": "OpenVPN Server SEFAZ - RECEITA Clients Connected"
          },
          "queryType": "0",
          "refId": "AC",
          "resultFormat": "time_series"
        },
        {
          "datasource": {
            "type": "alexanderzobnin-zabbix-datasource",
            "uid": "aec2bvjiis7pca"
          },
          "group": {
            "filter": "SRVINTRANET"
          },
          "host": {
            "filter": "PFSENSE"
          },
          "item": {
            "filter": "OpenVPN Server PCIVIL Clients Connected"
          },
          "queryType": "0",
          "refId": "AD",
          "resultFormat": "time_series"
        },
        {
          "datasource": {
            "type": "alexanderzobnin-zabbix-datasource",
            "uid": "aec2bvjiis7pca"
          },
          "group": {
            "filter": "SRVINTRANET"
          },
          "host": {
            "filter": "PFSENSE"
          },
          "item": {
            "filter": "OpenVPN Server IBROWSER Clients Connected"
          },
          "queryType": "0",
          "refId": "AE",
          "resultFormat": "time_series"
        },
        {
          "datasource": {
            "type": "alexanderzobnin-zabbix-datasource",
            "uid": "aec2bvjiis7pca"
          },
          "group": {
            "filter": "SRVINTRANET"
          },
          "host": {
            "filter": "PFSENSE"
          },
          "item": {
            "filter": "OpenVPN Server IBROWSER-CGE Clients Connected"
          },
          "queryType": "0",
          "refId": "AF",
          "resultFormat": "time_series"
        },
        {
          "datasource": {
            "type": "alexanderzobnin-zabbix-datasource",
            "uid": "aec2bvjiis7pca"
          },
          "group": {
            "filter": "SRVINTRANET"
          },
          "host": {
            "filter": "PFSENSE"
          },
          "item": {
            "filter": "OpenVPN Server FIPLAN Clients Connected"
          },
          "queryType": "0",
          "refId": "AG",
          "resultFormat": "time_series"
        },
        {
          "datasource": {
            "type": "alexanderzobnin-zabbix-datasource",
            "uid": "aec2bvjiis7pca"
          },
          "group": {
            "filter": "SRVINTRANET"
          },
          "host": {
            "filter": "PFSENSE"
          },
          "item": {
            "filter": "OpenVPN Server DENASUS Clients Connected"
          },
          "queryType": "0",
          "refId": "AH",
          "resultFormat": "time_series"
        },
        {
          "datasource": {
            "type": "alexanderzobnin-zabbix-datasource",
            "uid": "aec2bvjiis7pca"
          },
          "group": {
            "filter": "SRVINTRANET"
          },
          "host": {
            "filter": "PFSENSE"
          },
          "item": {
            "filter": "OpenVPN Server CETIF Clients Connected"
          },
          "queryType": "0",
          "refId": "AI",
          "resultFormat": "time_series"
        }
      ],
      "title": "CETIF – pfSense Central Monitoring",
      "type": "gapit-htmlgraphics-panel"
    }
  ],
  "preload": false,
  "refresh": "30s",
  "schemaVersion": 40,
  "tags": [
    "pfsense",
    "zabbix",
    "CETIF",
    "monitoring"
  ],
  "templating": {
    "list": []
  },
  "time": {
    "from": "now-3h",
    "to": "now"
  },
  "timepicker": {},
  "timezone": "browser",
  "title": "CETIF – pfSense Central Monitoring (Perplexy)",
  "uid": "CETIF_pfsense_v4",
  "version": 2,
  "weekStart": "",
  "description": "Complete NOC dashboard with system health, network traffic, gateways, OpenVPN, IPsec, CARP and alerts"
}