{
  "annotations": {
    "list": [
      {
        "builtIn": 1,
        "datasource": {
          "type": "grafana",
          "uid": "-- Grafana --"
        },
        "enable": true,
        "hide": true,
        "iconColor": "rgba(0, 211, 255, 1)",
        "name": "Annotations & Alerts",
        "type": "dashboard"
      }
    ]
  },
  "description": "Monitoramos os sites do Governo de Roraima em tempo real com alertas SSL e m√©tricas detalhadas",
  "editable": true,
  "fiscalYearStartMonth": 0,
  "graphTooltip": 0,
  "id": null,
  "links": [],
  "panels": [
    {
      "datasource": {
        "type": "alexanderzobnin-zabbix-datasource",
        "uid": "${DS_ZABBIX}"
      },
      "fieldConfig": {
        "defaults": {},
        "overrides": []
      },
      "gridPos": {
        "h": 37,
        "w": 24,
        "x": 0,
        "y": 0
      },
      "id": 1,
      "options": {
        "SVGBaseFix": true,
        "add100Percentage": true,
        "calcsMutation": "standard",
        "centerAlignContent": true,
        "dynamicData": false,
        "dynamicFieldDisplayValues": false,
        "dynamicHtmlGraphics": false,
        "dynamicProps": false,
        "html": "",
        "onInit": "",
        "onInitOnResize": false,
        "onRender": "/********************************************************************************************\n * GovDown Detector v3.1 - SEFAZ RR - Dashboard DownDetector Style\n * + SSL Monitoring + M√©tricas Vis√≠veis + Nomes Completos\n * Data: 2026-01-05\n ********************************************************************************************/\n(() => {\n  if (!htmlNode) return;\n\n  const styles = `\n    <style>\n      @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap');\n\n      * { margin: 0; padding: 0; box-sizing: border-box; }\n\n      .govmonitor-container {\n        font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;\n        background-color: #f6f6f6;\n        color: #212529;\n        min-height: 100vh;\n      }\n\n      .navbar {\n        background-color: #fff;\n        border-bottom: 1px solid #e3e3e3;\n        padding: 15px 20px;\n      }\n\n      .navbar-content {\n        max-width: 1320px;\n        margin: 0 auto;\n        display: flex;\n        align-items: center;\n        justify-content: space-between;\n        flex-wrap: wrap;\n        gap: 15px;\n      }\n\n      .logo {\n        font-size: 24px;\n        font-weight: bold;\n        color: #e94334;\n      }\n\n      .logo-subtitle {\n        font-size: 12px;\n        color: #666;\n        font-weight: normal;\n      }\n\n      .navbar-stats {\n        display: flex;\n        gap: 20px;\n        align-items: center;\n      }\n\n      .stat-item {\n        font-size: 13px;\n        color: #555;\n      }\n\n      .stat-value {\n        font-weight: 600;\n        margin-right: 4px;\n      }\n\n      .stat-value.good { color: #2e7d32; }\n      .stat-value.warning { color: #e65100; }\n      .stat-value.danger { color: #c62828; }\n\n      .last-update {\n        font-size: 14px;\n        color: #666;\n      }\n\n      .hero {\n        background-color: #f6f6f6;\n        padding: 40px 20px 30px;\n        text-align: center;\n      }\n\n      .hero h1 {\n        font-size: 2rem;\n        font-weight: 300;\n        margin-bottom: 15px;\n        color: #2b2c30;\n      }\n\n      .hero p {\n        font-size: 1rem;\n        font-weight: 300;\n        color: #555;\n        max-width: 800px;\n        margin: 0 auto;\n      }\n\n      .main-content {\n        padding: 30px 20px 40px;\n        max-width: 1320px;\n        margin: 0 auto;\n      }\n\n      .service-grid {\n        display: grid;\n        grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));\n        gap: 20px;\n      }\n\n      .service-card {\n        background: #fff;\n        border: 1px solid #eee;\n        padding: 20px 10px;\n        text-align: center;\n        transition: transform 0.2s, box-shadow 0.2s;\n        cursor: pointer;\n        min-height: 240px;\n        display: flex;\n        flex-direction: column;\n        border-radius: 4px;\n        position: relative;\n      }\n\n      .service-card:hover {\n        transform: translateY(-2px);\n        box-shadow: 0 4px 12px rgba(0,0,0,0.1);\n      }\n\n      .service-card.status-down-card { border-left: 4px solid #c62828; }\n      .service-card.status-degraded-card { border-left: 4px solid #e65100; }\n\n      .ssl-badge {\n        position: absolute;\n        top: 8px;\n        right: 8px;\n        background: #2e7d32;\n        color: #fff;\n        font-size: 9px;\n        padding: 3px 6px;\n        border-radius: 8px;\n        font-weight: 600;\n      }\n\n      .ssl-badge.warning { background: #e65100; }\n      .ssl-badge.critical { background: #c62828; }\n\n      .logo-wrapper {\n        height: 60px;\n        display: flex;\n        align-items: center;\n        justify-content: center;\n        margin-bottom: 12px;\n        font-size: 40px;\n      }\n\n      .service-name {\n        font-size: 16px;\n        font-weight: 600;\n        color: #2b2c30;\n        margin-bottom: 6px;\n        line-height: 1.3;\n        min-height: 40px;\n        display: flex;\n        align-items: center;\n        justify-content: center;\n      }\n\n      .service-url {\n        font-size: 10px;\n        color: #999;\n        margin-bottom: 10px;\n      }\n\n      .metrics-row {\n        display: flex;\n        justify-content: center;\n        gap: 10px;\n        margin: 8px 0;\n      }\n\n      .metric {\n        font-size: 10px;\n        padding: 2px 6px;\n        background: #f5f5f5;\n        border-radius: 4px;\n        color: #555;\n      }\n\n      .metric-value {\n        font-weight: 600;\n        color: #2e7d32;\n      }\n\n      .metric-value.warning { color: #e65100; }\n      .metric-value.danger { color: #c62828; }\n\n      .sparkline-container {\n        width: 76%;\n        margin: 0 auto;\n        height: 40px;\n        display: flex;\n        align-items: flex-end;\n        justify-content: space-between;\n        gap: 2px;\n        margin-top: auto;\n      }\n\n      .sparkline-bar {\n        flex: 1;\n        background: linear-gradient(180deg, #4CAF50 0%, #45a049 100%);\n        border-radius: 2px 2px 0 0;\n        min-height: 3px;\n        transition: all 0.3s;\n      }\n\n      .sparkline-bar.warning { background: linear-gradient(180deg, #ff9800 0%, #f57c00 100%); }\n      .sparkline-bar.danger { background: linear-gradient(180deg, #f44336 0%, #d32f2f 100%); }\n\n      .status-badge {\n        display: inline-block;\n        padding: 4px 12px;\n        border-radius: 12px;\n        font-size: 11px;\n        font-weight: 600;\n        text-transform: uppercase;\n        margin-top: 10px;\n      }\n\n      .status-operational { background: #e8f5e9; color: #2e7d32; }\n      .status-degraded { background: #fff3e0; color: #e65100; }\n      .status-down { background: #ffebee; color: #c62828; }\n\n      .footer {\n        background-color: #3c4043;\n        color: #bdc1c6;\n        padding: 20px;\n        text-align: center;\n        font-size: 14px;\n        margin-top: 30px;\n      }\n\n      @media (max-width: 768px) {\n        .hero h1 { font-size: 1.5rem; }\n        .service-grid { grid-template-columns: repeat(auto-fill, minmax(180px, 1fr)); gap: 15px; }\n      }\n\n      @media (min-width: 1400px) {\n        .service-grid { grid-template-columns: repeat(6, 1fr); }\n      }\n\n      @media (min-width: 1920px) {\n        .main-content { max-width: 1800px; }\n        .service-grid { grid-template-columns: repeat(8, 1fr); }\n        .hero h1 { font-size: 2.5rem; }\n      }\n    </style>\n  `;\n\n  const panelData = (typeof data !== 'undefined' && data) || (typeof panel !== 'undefined' && panel.data) || null;\n  const series = panelData && Array.isArray(panelData.series) ? panelData.series : [];\n\n  const toNumber = (value) => {\n    if (value == null) return null;\n    if (typeof value === 'number') return Number.isFinite(value) ? value : null;\n    if (typeof value === 'string' && value.trim() !== '') {\n      let str = value.trim().toLowerCase();\n      let multiplier = 1;\n      if (str.endsWith('ms')) { str = str.replace('ms', '').trim(); multiplier = 0.001; }\n      else if (str.endsWith('s')) { str = str.replace('s', '').trim(); }\n      const num = parseFloat(str);\n      return Number.isFinite(num) ? num * multiplier : null;\n    }\n    return null;\n  };\n\n  const getLastValue = (frame) => {\n    if (!frame || !frame.fields) return null;\n    const valueField = frame.fields.find(f => f.type === 'number') || frame.fields[1];\n    if (!valueField) return null;\n    const vals = valueField.values;\n    if (vals && typeof vals.get === 'function') {\n      const len = typeof vals.length === 'number' ? vals.length : (typeof vals.toArray === 'function' ? vals.toArray().length : 0);\n      return len ? vals.get(len - 1) : null;\n    }\n    if (Array.isArray(vals)) return vals.length ? vals[vals.length - 1] : null;\n    return null;\n  };\n\n  const getAllValues = (frame) => {\n    if (!frame || !frame.fields) return [];\n    const valueField = frame.fields.find(f => f.type === 'number') || frame.fields[1];\n    if (!valueField) return [];\n    const vals = valueField.values;\n    if (vals && typeof vals.toArray === 'function') return vals.toArray();\n    if (Array.isArray(vals)) return vals;\n    return [];\n  };\n\n  const getHost = (frame) => {\n    const f = frame && frame.fields ? frame.fields[1] : null;\n    const labels = (f && f.labels) || frame.labels || (frame.meta && frame.meta.custom) || {};\n    const byLabel = labels.host || labels.Host || labels.hostname || null;\n    if (byLabel) return byLabel.replace(/:+$/, '').trim();\n    let name = String(frame && frame.name ? frame.name : '');\n    const sslMatch = name.match(/^(SITE\\s+)?(.+?):\\s*(Expires on|Valid from)/i);\n    if (sslMatch) return 'SITE ' + sslMatch[2].trim();\n    const websiteMatch = name.match(/^(SITE\\s+)?(.+?):\\s*Website/i);\n    if (websiteMatch) return 'SITE ' + websiteMatch[2].trim();\n    const simpleMatch = name.match(/^(SITE\\s+)?([A-Z\\s]+)/i);\n    if (simpleMatch && simpleMatch[2]) return 'SITE ' + simpleMatch[2].trim().replace(/:+$/, '');\n    return 'UNKNOWN';\n  };\n\n  const byRef = {};\n  series.forEach(s => { const ref = s.refId || 'unknown'; (byRef[ref] = byRef[ref] || []).push(s); });\n\n  const indexByHost = (frames, getAllVals = false) => {\n    const map = {};\n    (frames || []).forEach(f => {\n      const h = getHost(f);\n      if (h && h !== 'UNKNOWN') {\n        if (getAllVals) {\n          map[h] = getAllValues(f).map(v => toNumber(v)).filter(v => v != null);\n        } else {\n          let v = getLastValue(f);\n          v = toNumber(v) ?? v;\n          if (v != null) map[h] = v;\n        }\n      }\n    });\n    return map;\n  };\n\n  const ping = indexByHost(byRef['A']);\n  const status = indexByHost(byRef['B']);\n  const httpRt = indexByHost(byRef['C']);\n  const httpRtHistory = indexByHost(byRef['C'], true);\n  const sslExpiry = indexByHost(byRef['E']);\n\n  const serviceConfig = {\n    'SITE SEFAZ': { name: 'SEFAZ', fullName: 'Secretaria da Fazenda', url: 'sefaz.rr.gov.br', emoji: 'üí∞' },\n    'SITE SESP': { name: 'SESP', fullName: 'Secretaria de Seguran√ßa P√∫blica', url: 'sesp.rr.gov.br', emoji: 'üõ°Ô∏è' },\n    'SITE EDUCACAO': { name: 'EDUCA√á√ÉO', fullName: 'Secretaria de Educa√ß√£o e Desporto', url: 'educacao.rr.gov.br', emoji: 'üìö' },\n    'SITE OUVIDORIA': { name: 'OUVIDORIA', fullName: 'Ouvidoria Geral do Estado', url: 'ouvidoria.rr.gov.br', emoji: 'üì¢' },\n    'SITE SEINF': { name: 'SEINF', fullName: 'Secretaria de Infraestrutura', url: 'seinf.rr.gov.br', emoji: 'üèóÔ∏è' },\n    'SITE SETRABES': { name: 'SETRABES', fullName: 'Secretaria do Trabalho e Bem-Estar Social', url: 'setrabes.rr.gov.br', emoji: 'ü§ù' },\n    'SITE FAPERR': { name: 'FAPERR', fullName: 'Funda√ß√£o de Amparo √† Pesquisa', url: 'faperr.rr.gov.br', emoji: 'üî¨' },\n    'SITE SEPLAN': { name: 'SEPLAN', fullName: 'Secretaria de Planejamento e Desenvolvimento', url: 'seplan.rr.gov.br', emoji: 'üìä' },\n    'SITE SEED': { name: 'SEED', fullName: 'Secretaria de Economia', url: 'seed.rr.gov.br', emoji: 'üìà' },\n    'SITE POLICIA CIVIL': { name: 'POL√çCIA CIVIL', fullName: 'Pol√≠cia Civil do Estado de Roraima', url: 'policiacivil.rr.gov.br', emoji: 'üëÆ' },\n    'SITE PGE': { name: 'PGE', fullName: 'Procuradoria Geral do Estado', url: 'www.pge.rr.gov.br', emoji: '‚öñÔ∏è' },\n    'SITE SECULT': { name: 'SECULT', fullName: 'Secretaria de Cultura', url: 'secult.rr.gov.br', emoji: 'üé≠' },\n    'SITE TRANSPARENCIA': { name: 'TRANSPAR√äNCIA', fullName: 'Portal da Transpar√™ncia', url: 'transparencia.rr.gov.br', emoji: 'üîç' },\n    'SITE ADERR': { name: 'ADERR', fullName: 'Ag√™ncia de Defesa Agropecu√°ria', url: 'aderr.rr.gov.br', emoji: 'üå±' },\n    'SITE CODESAIMA': { name: 'CODESAIMA', fullName: 'Companhia de Desenvolvimento de Roraima', url: 'codesaima.rr.gov.br', emoji: 'üå≥' },\n    'SITE IPEM': { name: 'IPEM', fullName: 'Instituto de Pesos e Medidas', url: 'ipem.rr.gov.br', emoji: '‚öñÔ∏è' },\n    'SITE IMPRENSA OFICIAL': { name: 'IMPRENSA', fullName: 'Imprensa Oficial do Estado', url: 'imprensaoficial.rr.gov.br', emoji: 'üì∞' }\n  };\n\n  const hosts = new Set();\n  [ping, status, httpRt, sslExpiry].forEach(m => { Object.keys(m || {}).forEach(h => hosts.add(h)); });\n\n  const now = Math.floor(Date.now() / 1000);\n  let sslWarnings = 0;\n\n  let services = Array.from(hosts).map(h => {\n    const config = serviceConfig[h] || { \n      name: h.replace(/^SITE\\s+/i, ''), \n      fullName: h.replace(/^SITE\\s+/i, ''),\n      url: '', \n      emoji: 'üèõÔ∏è' \n    };\n\n    const pingVal = toNumber(ping[h]);\n    const statusVal = toNumber(status[h]);\n    const hasPing = pingVal != null;\n    const hasStatus = statusVal != null;\n    const isUp = (hasPing && pingVal > 0) || (hasStatus && statusVal >= 200 && statusVal < 400);\n\n    const respTimeRaw = toNumber(httpRt[h]) || 0;\n    const respTime = Math.round(respTimeRaw * 1000);\n    \n    const sslExp = toNumber(sslExpiry[h]);\n    const sslDays = sslExp ? Math.floor((sslExp - now) / 86400) : null;\n    \n    if (sslDays && sslDays < 30) sslWarnings++;\n\n    let statusLabel = 'operational';\n    if (!isUp && (hasPing || hasStatus)) {\n      statusLabel = 'down';\n    } else if (respTime > 3000) {\n      statusLabel = 'degraded';\n    }\n\n    let history = httpRtHistory[h] || [];\n    if (history.length === 0) history = Array(12).fill(0);\n    history = history.slice(-12);\n    while (history.length < 12) history.unshift(0);\n\n    return {\n      host: h,\n      name: config.name,\n      fullName: config.fullName,\n      url: config.url,\n      emoji: config.emoji,\n      status: statusLabel,\n      statusCode: Math.round(statusVal || 0),\n      respTime,\n      sslDays,\n      history\n    };\n  }).filter(s => s.host !== 'UNKNOWN');\n\n  services.sort((a, b) => {\n    const order = { 'down': 0, 'degraded': 1, 'operational': 2 };\n    return order[a.status] - order[b.status];\n  });\n\n  const timeStr = new Date().toLocaleTimeString('pt-BR', { hour: '2-digit', minute: '2-digit', second: '2-digit' });\n  const online = services.filter(s => s.status === 'operational').length;\n  const problems = services.filter(s => s.status !== 'operational').length;\n\n  const generateSparkline = (history, isDown) => {\n    const maxVal = Math.max(...history, 0.001);\n    return history.map(val => {\n      const height = Math.max((val / maxVal) * 100, 10);\n      let barClass = '';\n      if (isDown) barClass = 'danger';\n      else if (val > maxVal * 0.7) barClass = 'warning';\n      return `<div class=\"sparkline-bar ${barClass}\" style=\"height: ${height}%\"></div>`;\n    }).join('');\n  };\n\n  const servicesHtml = services.length > 0 ? services.map(s => {\n    const cardClass = s.status === 'down' ? 'status-down-card' : (s.status === 'degraded' ? 'status-degraded-card' : '');\n    const badgeClass = s.status === 'down' ? 'status-down' : (s.status === 'degraded' ? 'status-degraded' : 'status-operational');\n    const badgeText = s.status === 'down' ? '‚úó Fora do Ar' : (s.status === 'degraded' ? '‚ö† Degradado' : '‚úì Operacional');\n    \n    let sslBadge = '';\n    if (s.sslDays !== null) {\n      const sslClass = s.sslDays < 7 ? 'critical' : (s.sslDays < 30 ? 'warning' : '');\n      sslBadge = `<div class=\"ssl-badge ${sslClass}\">üîí ${s.sslDays}d</div>`;\n    }\n    \n    const respClass = s.respTime > 3000 ? 'danger' : (s.respTime > 1000 ? 'warning' : '');\n    const codeClass = !s.statusCode ? '' : (s.statusCode >= 200 && s.statusCode < 300 ? '' : (s.statusCode >= 300 && s.statusCode < 400 ? 'warning' : 'danger'));\n\n    return `\n      <div class=\"service-card ${cardClass}\" onclick=\"window.open('https://${s.url}', '_blank')\">\n        ${sslBadge}\n        <div class=\"logo-wrapper\">${s.emoji}</div>\n        <div class=\"service-name\">${s.fullName}</div>\n        <div class=\"service-url\">${s.url}</div>\n        <div class=\"metrics-row\">\n          ${s.statusCode ? `<div class=\"metric\">HTTP <span class=\"metric-value ${codeClass}\">${s.statusCode}</span></div>` : ''}\n          <div class=\"metric\">Resp <span class=\"metric-value ${respClass}\">${s.respTime}ms</span></div>\n        </div>\n        <div class=\"sparkline-container\">${generateSparkline(s.history, s.status === 'down')}</div>\n        <div class=\"status-badge ${badgeClass}\">${badgeText}</div>\n      </div>\n    `;\n  }).join('') : `\n    <div style=\"grid-column: 1/-1; text-align: center; padding: 60px; color: #6c757d;\">\n      <div style=\"font-size: 48px; margin-bottom: 16px;\">üì°</div>\n      <h3 style=\"color: #212529; margin-bottom: 8px;\">Aguardando dados...</h3>\n      <p>Os dados dos servi√ßos ser√£o exibidos assim que estiverem dispon√≠veis.</p>\n    </div>\n  `;\n\n  htmlNode.innerHTML = styles + `\n    <div class=\"govmonitor-container\">\n      <nav class=\"navbar\">\n        <div class=\"navbar-content\">\n          <div class=\"logo\">\n            GovDown Detector - SEFAZ RR\n            <div class=\"logo-subtitle\">Status dos Servi√ßos Governamentais v3.1</div>\n          </div>\n          <div class=\"navbar-stats\">\n            <div class=\"stat-item\"><span class=\"stat-value good\">${online}</span> Operacionais</div>\n            <div class=\"stat-item\"><span class=\"stat-value danger\">${problems}</span> Problemas</div>\n            ${sslWarnings > 0 ? `<div class=\"stat-item\"><span class=\"stat-value warning\">üîí ${sslWarnings}</span> SSL</div>` : ''}\n          </div>\n          <div class=\"last-update\">‚è± ${timeStr}</div>\n        </div>\n      </nav>\n\n      <section class=\"hero\">\n        <h1>Status em tempo real dos servi√ßos governamentais</h1>\n        <p>Monitoramos os sites do Governo de Roraima em tempo real com alertas SSL e m√©tricas detalhadas</p>\n      </section>\n\n      <main class=\"main-content\">\n        <div class=\"service-grid\">${servicesHtml}</div>\n      </main>\n\n      <footer class=\"footer\">\n        <p>&copy; 2026 Governo do Estado de Roraima - Monitoramento Interno SEFAZ</p>\n        <p style=\"margin-top: 10px;\">Atualiza√ß√£o autom√°tica via Grafana | Dashboard v3.1</p>\n      </footer>\n    </div>\n  `;\n})();",
        "overflow": "visible",
        "panelupdateOnMount": true,
        "renderOnMount": true,
        "rootCSS": "",
        "useGrafanaScrollbar": true
      },
      "pluginVersion": "2.2.3",
      "targets": [
        {
          "group": { "filter": "SITES GOVERNAMENTAIS" },
          "host": { "filter": "/.*/" },
          "item": { "filter": "/^Website \\{\\$SITE_URL\\} HTTP Ping Check$/" },
          "queryType": "0",
          "refId": "A",
          "resultFormat": "time_series"
        },
        {
          "group": { "filter": "SITES GOVERNAMENTAIS" },
          "host": { "filter": "/.*/" },
          "item": { "filter": "/^Website \\{\\$SITE_URL\\} HTTP Status Code$/" },
          "queryType": "0",
          "refId": "B",
          "resultFormat": "time_series"
        },
        {
          "group": { "filter": "SITES GOVERNAMENTAIS" },
          "host": { "filter": "/.*/" },
          "item": { "filter": "/^Website \\{\\$SITE_URL\\} HTTP Response Time$/" },
          "queryType": "0",
          "refId": "C",
          "resultFormat": "time_series"
        },
        {
          "group": { "filter": "SITES GOVERNAMENTAIS" },
          "host": { "filter": "/.*/" },
          "item": { "filter": "/^Expires on$/" },
          "queryType": "0",
          "refId": "E",
          "resultFormat": "time_series"
        }
      ],
      "title": "",
      "type": "gapit-htmlgraphics-panel"
    }
  ],
  "preload": false,
  "refresh": "1m",
  "schemaVersion": 40,
  "tags": [
    "govmonitor",
    "downdetector",
    "roraima",
    "v3.1",
    "ssl"
  ],
  "templating": {
    "list": [
      {
        "current": {},
        "includeAll": false,
        "name": "DS_ZABBIX",
        "options": [],
        "query": "alexanderzobnin-zabbix-datasource",
        "refresh": 1,
        "regex": "",
        "type": "datasource"
      }
    ]
  },
  "time": {
    "from": "now-1h",
    "to": "now"
  },
  "timepicker": {},
  "timezone": "browser",
  "title": "GovDown Detector v3.1 - DownDetector Style + SSL",
  "uid": "govdown-detector-v3-1-ssl",
  "version": 1,
  "weekStart": ""
}
